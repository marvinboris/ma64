var G=Object.defineProperty;var L=(o,r,s)=>r in o?G(o,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[r]=s;var x=(o,r,s)=>L(o,typeof r!="symbol"?r+"":r,s);import{c as M,r as z,j as e,N as V,C as O,R as S,I as K,F,f as R,q as Q,a as X}from"./index-BncDn27B.js";import{F as w}from"./FormGroup-CjRq5iBt.js";import{B as Y,S as Z,a as ee}from"./Subtitle-EIBA-Hk5.js";import{e as se}from"./Error-CC8F97pB.js";import{F as _,a as te}from"./Input-BldVOD2V.js";import{S as ae}from"./index-3VnVM_zO.js";import{T as ie}from"./index-C0jNRMwo.js";import{F as oe}from"./Feedback-C0SvNv4r.js";import{a as re,b as ne,p as pe,c as le,r as de}from"./posts-WRngtTc9.js";import{a as ce}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const H="blog",U={title:{},body:{},photo:null,post_category_id:"",is_active:"1",translate:"",add:!1};class he extends z.Component{constructor(){super(...arguments);x(this,"state",{...U});x(this,"saveHandler",s=>{var a,l,i,n,p;s.preventDefault(),this.props.edit?(i=(l=this.props).patch)==null||i.call(l,(a=this.props.match)==null?void 0:a.params.id,s.target):(p=(n=this.props).post)==null||p.call(n,s.target)});x(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,a;return(a=(s=this.props).post)==null?void 0:a.call(s,document.querySelector("form"))}));x(this,"inputChangeHandler",s=>{const{name:a,value:l,files:i}=s.target;if(i&&ce(s.target),a.includes("[")){const{translate:n}=this.state,p=a.split("[")[0],d=this.state[p];return d&&(d[n]=l),this.setState({[p]:d})}this.setState({[a]:i?i[0]:l})});x(this,"fileUpload",()=>{var s;return(s=document.getElementById("photo"))==null?void 0:s.click()})}componentDidMount(){var s,a,l,i,n,p;(a=(s=this.props).reset)==null||a.call(s),this.props.edit&&this.props.match?(i=(l=this.props).show)==null||i.call(l,this.props.match.params.id):(p=(n=this.props).info)==null||p.call(n),this.setState({translate:"fr"})}componentDidUpdate(s){var a,l,i,n,p,d,c,g,j,f,h,m,b;if(!((l=(a=s.backend)==null?void 0:a.posts)!=null&&l.message)&&((n=(i=this.props.backend)==null?void 0:i.posts)!=null&&n.message)&&this.props.backend.posts.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({...U,translate:"fr"}):(p=this.props.history)==null||p.push({pathname:"/user/posts",state:{message:this.props.backend.posts.message}})),!((c=(d=s.backend)==null?void 0:d.posts)!=null&&c.post)&&((j=(g=this.props.backend)==null?void 0:g.posts)!=null&&j.post)||this.props.edit&&!((h=(f=s.backend)==null?void 0:f.posts)!=null&&h.message)&&((b=(m=this.props.backend)==null?void 0:m.posts)!=null&&b.message)&&this.props.backend.posts.message.type==="success"){if(!this.props.backend.posts)return;const{backend:{posts:{post:v}}}=this.props;this.setState({...v})}}componentWillUnmount(){var s,a;(a=(s=this.props).reset)==null||a.call(s)}render(){var P,T,q;if(!((P=this.props.content)!=null&&P.cms)||!((T=this.props.backend)!=null&&T.posts)||!((q=this.props.auth)!=null&&q.data))return null;let{content:{cms:{pages:{components:{form:{active:s,inactive:a}},backend:{pages:{posts:{title:l,add:i,edit:n,index:p,form:d}}}}},languages:c},backend:{posts:{loading:g,error:j,message:f,post:h,post_categories:m}},auth:{data:{role:{features:b}}}}=this.props,{title:v,photo:u,post_category_id:W,is_active:B,body:D,translate:y}=this.state,N,I=null;const k=localStorage.getItem("lang")||"",A=b.find(t=>t.prefix==="posts"),E=!(A&&JSON.parse(A.permissions).includes(this.props.edit?"u":"c"))&&e.jsx(V,{to:"/user/dashboard"}),J=c==null?void 0:c.sort((t,C)=>t.name.localeCompare(C.name)).map(t=>e.jsx("option",{value:t.abbr,children:t.name},JSON.stringify(t)));m||(m=[]);const $=m.sort((t,C)=>t.name[k].localeCompare(C.name[k])).map(t=>e.jsx("option",{value:t.id,children:t.name[k]},JSON.stringify(t)));return g?N=e.jsx(O,{xs:12,children:e.jsx(X,{})}):(I=e.jsx(e.Fragment,{children:e.jsx(se,{err:j})}),N=e.jsx(e.Fragment,{children:e.jsxs(O,{xl:9,children:[e.jsx(oe,{message:f}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(S,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsx("div",{className:"row",children:c==null?void 0:c.map(t=>e.jsxs(z.Fragment,{children:[e.jsx(_,{type:"text",id:"title-"+t.abbr,className:"col-md-12"+(t.abbr===y?"":" d-none"),icon:H,onChange:this.inputChangeHandler,value:v[t.abbr],name:"title["+t.abbr+"]",required:!0,placeholder:d.title}),e.jsxs(w,{id:"body-"+t.abbr,className:"col-md-12"+(t.abbr===y?"":" d-none"),children:[this.props.edit&&h&&h.body[t.abbr]===D[t.abbr]&&e.jsx(e.Fragment,{}),!this.props.edit&&e.jsx(e.Fragment,{})]})]},"language-"+t.abbr))})}),e.jsx("div",{className:"col-lg-3",children:e.jsx(w,{children:e.jsx(K,{type:"select",name:"translate",onChange:this.inputChangeHandler,value:y,children:J})})}),e.jsx("div",{className:"col-12 mb-3",children:e.jsx("hr",{})}),e.jsx("div",{className:"col-lg-9",children:e.jsx(w,{children:e.jsx("div",{id:"embed-photo",className:"embed-responsive embed-responsive-21by9 bg-soft rounded-8 d-flex justify-content-center align-items-center position-relative",style:{cursor:"pointer",backgroundImage:u?`url("${u}")`:void 0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",overflow:"visible"},onClick:this.fileUpload,children:this.props.edit?u&&u!==(h==null?void 0:h.photo)&&e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(F,{icon:R,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):u?e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(F,{icon:R,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):e.jsxs("div",{className:"text-center text-light w-100 overflow-hidden px-3",children:[e.jsx("div",{children:e.jsx(F,{icon:Q,fixedWidth:!0,size:"4x"})}),e.jsx("div",{className:"mt-3 mb-1 text-center text-12 text-truncate",children:d.upload}),e.jsx("div",{className:"text-center text-12 text-truncate",children:d.size})]})})})}),e.jsx("div",{className:"col-lg-9",children:e.jsxs(S,{children:[e.jsxs(_,{className:"col-md-6",type:"select",name:"post_category_id",placeholder:d.post_category,onChange:this.inputChangeHandler,icon:"th-list",required:!0,value:W,children:[e.jsx("option",{children:d.select_post_category}),$]}),e.jsxs(_,{type:"select",className:"col-md-6",icon:"pencil-alt",onChange:this.inputChangeHandler,value:B,name:"is_active",required:!0,children:[e.jsx("option",{children:d.select_status}),e.jsx("option",{value:1,children:s}),e.jsx("option",{value:0,children:a})]})]})}),e.jsx(ae,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(Y,{items:this.props.edit?[{to:"/user/posts",content:p}]:void 0,main:this.props.edit?n:i,icon:H}),e.jsx(Z,{children:l}),e.jsx(ee,{children:this.props.edit?n:i})]}),e.jsxs("div",{children:[E,I,e.jsx(S,{children:e.jsxs(te,{onSubmit:this.saveHandler,icon:H,title:this.props.edit?n:i,list:p,link:"/user/posts",innerClassName:"row justify-content-center",children:[e.jsx("input",{type:"file",id:"photo",name:"photo",className:"d-none",onChange:this.inputChangeHandler,accept:".png,.jpg,.jpeg"}),N]})})]})]})}}const me=o=>({...o}),xe=o=>({show:r=>o(re(r)),info:()=>o(ne()),post:r=>o(pe(r)),patch:(r,s)=>o(le(r,s)),reset:()=>o(de())}),He=M(me,xe)(he);export{He as default};
