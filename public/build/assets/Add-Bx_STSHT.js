var O=Object.defineProperty;var E=(a,n,s)=>n in a?O(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s;var g=(a,n,s)=>E(a,typeof n!="symbol"?n+"":n,s);import{c as P,r as U,j as e,N as W,C as S,I,R as k,a as G}from"./index-BncDn27B.js";import{F as A}from"./FormGroup-CjRq5iBt.js";import{B as M,S as V,a as z}from"./Subtitle-EIBA-Hk5.js";import{e as K}from"./Error-CC8F97pB.js";import{F as T,a as L}from"./Input-BldVOD2V.js";import{S as Q}from"./index-3VnVM_zO.js";import{T as X}from"./index-C0jNRMwo.js";import{F as Y}from"./Feedback-C0SvNv4r.js";import{a as Z,b as ee,p as se,c as te,r as re}from"./roles-DVscBMdW.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const C="user-tag",_={name:"",description:"",features:[],add:!1};class ie extends U.Component{constructor(){super(...arguments);g(this,"state",{..._});g(this,"saveHandler",s=>{var t,i,o,r,d;s.preventDefault(),this.props.edit?(o=(i=this.props).patch)==null||o.call(i,(t=this.props.match)==null?void 0:t.params.id,s.target):(d=(r=this.props).post)==null||d.call(r,s.target)});g(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,t;return(t=(s=this.props).post)==null?void 0:t.call(s,document.querySelector("form"))}));g(this,"inputChangeHandler",s=>{const{id:t,name:i,value:o,checked:r,files:d}=s.target;if(i.includes("features")){let p=[...this.state.features];if(i.includes("id")){const[,h]=t.split("-"),c=p.find(l=>l.id&&+l.id==+h);r&&!c?p.push({id:h,permissions:[]}):p=p.filter(l=>l.id&&+l.id!=+h)}else if(i.includes("permissions")){const[,h,c]=t.split("-"),l=p.findIndex(u=>u.id&&+u.id==+h),x=p[l];let b=[...x.permissions||[]];const v=b.includes(c);r&&!v?b.push(c):b=b.filter(u=>u!==c),x.permissions=b,p[l]=x}return this.setState({features:p})}this.setState({[i]:d?d[0]:o})})}componentDidMount(){var s,t,i,o,r,d;(t=(s=this.props).reset)==null||t.call(s),this.props.edit&&this.props.match?(o=(i=this.props).show)==null||o.call(i,this.props.match.params.id):(d=(r=this.props).info)==null||d.call(r)}componentDidUpdate(s){var t,i,o,r,d,p,h,c,l;if(!((i=(t=s.backend)==null?void 0:t.roles)!=null&&i.message)&&((r=(o=this.props.backend)==null?void 0:o.roles)!=null&&r.message)&&this.props.backend.roles.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({..._}):(d=this.props.history)==null||d.push({pathname:"/user/roles",state:{message:this.props.backend.roles.message}})),!((h=(p=s.backend)==null?void 0:p.roles)!=null&&h.role)&&((l=(c=this.props.backend)==null?void 0:c.roles)!=null&&l.role)){const{backend:{roles:{role:x}}}=this.props;this.setState({...x})}}componentWillUnmount(){var s,t;(t=(s=this.props).reset)==null||t.call(s)}render(){var H,F,R;if(!((H=this.props.content)!=null&&H.cms)||!((F=this.props.backend)!=null&&F.roles)||!((R=this.props.auth)!=null&&R.data))return null;let{content:{cms:{pages:{backend:{pages:{roles:{title:s,add:t,edit:i,index:o,form:r}}}}}},backend:{roles:{loading:d,error:p,message:h,features:c}},auth:{data:{role:{features:l}}}}=this.props,{name:x,description:b,features:v}=this.state,u,y=null;const N=l.find(m=>m.prefix==="roles"),D=!(N&&JSON.parse(N.permissions).includes(this.props.edit?"u":"c"))&&e.jsx(W,{to:"/user/dashboard"});c||(c=[]);const q=c.sort((m,j)=>m.name.localeCompare(j.name)).map(m=>{const j=v.find(f=>f.id&&+f.id==+m.id),B=[{abbr:"c",name:r.create},{abbr:"u",name:r.update},{abbr:"d",name:r.delete}].map(f=>{var w;const J=j&&((w=j.permissions)==null?void 0:w.includes(f.abbr));return e.jsx(S,{lg:4,children:e.jsx(A,{children:e.jsx(I,{type:"checkbox",id:`feature-${m.id}-${f.abbr}`,checked:J,name:`features[${m.id}][permissions][${f.abbr}]`,onChange:this.inputChangeHandler,label:f.name})})},JSON.stringify(f))}),$=j!==void 0;return e.jsxs("div",{children:[e.jsx(I,{type:"switch",id:`feature-${m.id}`,className:"col-12 pb-2",checked:$,name:`features[${m.id}][id]`,onChange:this.inputChangeHandler,label:e.jsx("span",{className:"text-500",children:m.name})}),$&&e.jsx(k,{children:B})]},JSON.stringify(m))});return d?u=e.jsx(S,{xs:12,children:e.jsx(G,{})}):(y=e.jsx(e.Fragment,{children:e.jsx(K,{err:p})}),u=e.jsx(e.Fragment,{children:e.jsxs(S,{xl:9,children:[e.jsx(Y,{message:h}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(k,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsxs(k,{children:[e.jsx(T,{type:"text",className:"col-md-6",icon:C,onChange:this.inputChangeHandler,value:x,name:"name",required:!0,placeholder:r.name}),e.jsx(T,{type:"text",className:"col-md-6",icon:"edit",onChange:this.inputChangeHandler,value:b,name:"description",required:!0,placeholder:r.description}),e.jsx(S,{xs:12,className:"pb-2 text-large text-700",children:r.features}),e.jsx(A,{className:"col-12",children:q})]})}),e.jsx(Q,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(M,{items:this.props.edit?[{to:"/user/roles",content:o}]:void 0,main:this.props.edit?i:t,icon:C}),e.jsx(V,{children:s}),e.jsx(z,{children:this.props.edit?i:t})]}),e.jsxs("div",{children:[D,y,e.jsx(k,{children:e.jsx(L,{onSubmit:this.saveHandler,icon:C,title:this.props.edit?i:t,list:o,link:"/user/roles",innerClassName:"row justify-content-center",children:u})})]})]})}}const ae=a=>({...a}),ne=a=>({show:n=>a(Z(n)),info:()=>a(ee()),post:n=>a(se(n)),patch:(n,s)=>a(te(n,s)),reset:()=>a(re())}),Se=P(ae,ne)(ie);export{Se as default};
