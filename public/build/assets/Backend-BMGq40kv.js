var Z=Object.defineProperty;var ee=(a,t,r)=>t in a?Z(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;var B=(a,t,r)=>ee(a,typeof t!="symbol"?t+"":t,r);import{c as se,r as H,u as re,j as e,N as te,C as l,R as p,I as M,a as ne}from"./index-BncDn27B.js";import{F as P}from"./FormGroup-CjRq5iBt.js";import{B as ae,S as oe,a as ce}from"./Subtitle-EIBA-Hk5.js";import{e as ie}from"./Error-CC8F97pB.js";import{a as de}from"./Input-BldVOD2V.js";import{b as le}from"./BetweenButton-CNQ28UJ2.js";import{T as me}from"./index-C0jNRMwo.js";import{F as he}from"./Feedback-C0SvNv4r.js";import{g as pe,p as xe,r as be}from"./cms-Dgxu_C9N.js";import{B as b}from"./Backend-mU-JZRnG.js";import{r as u}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const A="wrench",f=({sm:a=!1})=>e.jsx(l,{xs:12,className:`mb-${a?2:3}`}),je=({backend:a,language:t})=>{const[r,n]=H.useState(`${t.abbr}-header`),[s,o]=H.useState(a),$=c=>{const{value:h}=c.target;h!==r&&n(h)},I=Object.keys(a||{}).sort((c,h)=>c.localeCompare(h)).map(c=>{const h=`${t.abbr}-${c}`;return e.jsx("option",{className:"text-capitalize",value:h,children:c.split("_").join(" ")},h)}),d=`${t.abbr}[backend]`,j=b.header,N=`${d}[header]`,D=s==null?void 0:s.header,g=["header"],F=u(s,o)(j,N,D,g,[],[{regex:`${N}[no_notification]`,action:()=>e.jsx(f,{})},{regex:`${N}[sure_logout]`,action:()=>e.jsx(f,{})}]),S=b.footer,V=`${d}[footer]`,y=s==null?void 0:s.footer,v=["footer"],T=u(s,o)(S,V,y,v),k=b.sidebar,x=`${d}[sidebar]`,m=s==null?void 0:s.sidebar,i=["sidebar"],_=u(s,o)(k,x,m,i,[{regex:`${x}[admin]`,action:()=>e.jsx(l,{xs:12,children:e.jsx("h4",{children:"Roles"})})},{regex:`${x}[menu][dashboard]`,action:()=>e.jsx(l,{xs:12,children:e.jsx("h4",{children:"Menu"})})},{regex:`${x}[menu][.+][title]`,action:c=>e.jsx(l,{xs:12,children:e.jsx("h5",{children:c})})}],[{regex:`${x}[user]`,action:()=>e.jsx(f,{})}]),R=b.pages.dashboard,C=`${d}[pages][dashboard]`,E=s==null?void 0:s.dashboard,z=["dashboard"],J=u(s,o)(R,C,E,z,[{regex:`${C}[admin][title]`,action:()=>e.jsx(l,{xs:12,children:e.jsx("h4",{children:"Admin"})})},{regex:`${C}[.+][blocks][total_issues][title]`,action:()=>e.jsx(l,{xs:12,children:e.jsx("h5",{children:"Blocks"})})},{regex:`${C}[user][title]`,action:()=>e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(l,{xs:12,children:e.jsx("h4",{children:"User"})})]})}],[{regex:`${C}[.+][subtitle]`,action:()=>e.jsx(f,{sm:!0})}]),L=b.pages.cms,O=`${d}[pages][cms]`,U=s==null?void 0:s.cms,W=["cms"],G=u(s,o)(L,O,U,W,[],[{regex:`${O}[auth]`,action:()=>e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(l,{xs:12,children:e.jsx("h4",{children:"Form"})})]})}]),K=Object.keys(b.pages).filter(c=>!["dashboard","cms"].includes(c)).map(c=>{const h=b.pages[c],w=`${d}[pages][${c}]`,q=s==null?void 0:s[c],Q=[c],X=u(s,o)(h,w,q,Q),Y=t.abbr+"-"+c;return e.jsx(p,{className:`pt-4 ${r===Y?"":"d-none"}`,children:X},t.abbr+"-"+w)});return e.jsxs(p,{children:[e.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:e.jsx(P,{children:e.jsx(M,{type:"select",name:"tab",onChange:$,className:"text-capitalize",value:r,children:I})})}),e.jsxs("div",{className:"col-12",children:[e.jsx(p,{className:`pt-4 ${r===t.abbr+"-header"?"":"d-none"}`,children:F}),e.jsx(p,{className:`pt-4 ${r===t.abbr+"-footer"?"":"d-none"}`,children:T}),e.jsx(p,{className:`pt-4 ${r===t.abbr+"-sidebar"?"":"d-none"}`,children:_}),e.jsx(p,{className:`pt-4 ${r===t.abbr+"-dashboard"?"":"d-none"}`,children:J}),e.jsx(p,{className:`pt-4 ${r===t.abbr+"-cms"?"":"d-none"}`,children:G}),K]})]},"Languages-"+t.abbr)};class ue extends H.Component{constructor(){super(...arguments);B(this,"state",{abbr:"fr"});B(this,"submitHandler",async r=>{var n,s;r.preventDefault(),await((s=(n=this.props).patch)==null?void 0:s.call(n,r.target))});B(this,"inputChangeHandler",r=>{const{name:n,value:s,files:o}=r.target;this.setState({[n]:o?o[0]:s})})}static getDerivedStateFromProps(r,n){var s,o;if((o=(s=r.backend)==null?void 0:s.cms)!=null&&o.cms&&n.app_name===""){const{backend:{cms:{cms:{backend:$}}}}=r;return re(n,{...$})}return n}async componentDidMount(){var r,n,s,o;(n=(r=this.props).reset)==null||n.call(r),(o=(s=this.props).get)==null||o.call(s)}componentWillUnmount(){var r,n;(n=(r=this.props).reset)==null||n.call(r)}render(){var y,v,T;if(!((y=this.props.content)!=null&&y.cms)||!((v=this.props.backend)!=null&&v.cms)||!((T=this.props.auth)!=null&&T.data))return null;let{content:{cms:{pages:{components:{form:{save:r}},backend:{pages:{cms:{title:n,backend:s}}}}}},backend:{cms:{loading:o,error:$,message:I,cms:d,languages:j}},auth:{data:{role:{features:N}}}}=this.props;const{abbr:D}=this.state;let g=null,F=null;const S=N.find(k=>k.prefix==="cms"),V=!(S&&JSON.parse(S.permissions).includes("u"))&&e.jsx(te,{to:"/user/dashboard"});if(o)g=e.jsx(l,{xs:12,children:e.jsx(ne,{})});else{F=e.jsx(e.Fragment,{children:e.jsx(ie,{err:$})}),j||(j=[]);const k=j.map(m=>e.jsx("option",{value:m.abbr,children:m.name},Math.random()+JSON.stringify(m))),x=j.map(m=>{const i=d==null?void 0:d.pages[m.abbr].backend,_={header:i==null?void 0:i.header,footer:i==null?void 0:i.footer,sidebar:i==null?void 0:i.sidebar,...i==null?void 0:i.pages};return e.jsx("div",{className:m.abbr===D?"":"d-none",children:e.jsx(je,{backend:_,language:m})},Math.random())});g=e.jsxs(l,{lg:9,children:[e.jsx(he,{message:I}),e.jsxs(p,{children:[e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:e.jsx(P,{children:e.jsx(M,{type:"select",name:"abbr",onChange:this.inputChangeHandler,value:D,children:k})})}),e.jsx("div",{className:"col-12",children:x}),e.jsx("div",{className:"col-12",children:e.jsx(le,{color:"green",icon:"save",children:r})})]})]})}return e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(ae,{main:s,icon:A}),e.jsx(oe,{children:n}),e.jsx(ce,{children:s})]}),e.jsxs("div",{className:"p-4 pb-0",children:[V,F,e.jsx(p,{children:e.jsx(de,{onSubmit:this.submitHandler,icon:A,title:s,link:"/admin/cms",innerClassName:"row justify-content-center",children:g})})]})]})}}const fe=a=>({...a}),$e=a=>({get:()=>a(pe()),patch:t=>a(xe("backend",t)),reset:()=>a(be())}),we=se(fe,$e)(ue);export{we as default};
