var _=Object.defineProperty;var q=(a,n,s)=>n in a?_(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s;var k=(a,n,s)=>q(a,typeof n!="symbol"?n+"":n,s);import{c as B,r as E,j as e,C as S,I as R,R as C,b9 as v,k as U,a as J}from"./index-BncDn27B.js";import{F as $}from"./FormGroup-CjRq5iBt.js";import{B as O,S as P,a as W}from"./Subtitle-EIBA-Hk5.js";import{e as G}from"./Error-CC8F97pB.js";import{F as w,a as M}from"./Input-BldVOD2V.js";import{S as V}from"./index-3VnVM_zO.js";import{T as z}from"./index-C0jNRMwo.js";import{F as K}from"./Feedback-C0SvNv4r.js";import{a as L,b as Q,p as X,c as Y,r as Z}from"./roles-DVscBMdW.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const I={name:"",description:"",features:[],add:!1};class ee extends E.Component{constructor(){super(...arguments);k(this,"state",{...I});k(this,"saveHandler",s=>{var t,r,o,i,d;s.preventDefault(),this.props.edit?(o=(r=this.props).patch)==null||o.call(r,(t=this.props.match)==null?void 0:t.params.id,s.target):(d=(i=this.props).post)==null||d.call(i,s.target)});k(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,t;return(t=(s=this.props).post)==null?void 0:t.call(s,document.querySelector("form"))}));k(this,"inputChangeHandler",s=>{const{id:t,name:r,value:o,checked:i,files:d}=s.target;if(r.includes("features")){let l=[...this.state.features];if(r.includes("id")){const[,m]=t.split("-"),c=l.find(p=>p.id&&+p.id==+m);i&&!c?l.push({id:m,permissions:[]}):l=l.filter(p=>p.id&&+p.id!=+m)}else if(r.includes("permissions")){const[,m,c]=t.split("-"),p=l.findIndex(b=>b.id&&+b.id==+m),f=l[p];let x=[...f.permissions||[]];const j=x.includes(c);i&&!j?x.push(c):x=x.filter(b=>b!==c),f.permissions=x,l[p]=f}return this.setState({features:l})}this.setState({[r]:d?d[0]:o})})}componentDidMount(){var s,t,r,o,i,d;(t=(s=this.props).reset)==null||t.call(s),this.props.edit&&this.props.match?(o=(r=this.props).show)==null||o.call(r,this.props.match.params.id):(d=(i=this.props).info)==null||d.call(i)}componentDidUpdate(s){var t,r,o,i,d,l,m,c,p;if(!((r=(t=s.backend)==null?void 0:t.roles)!=null&&r.message)&&((i=(o=this.props.backend)==null?void 0:o.roles)!=null&&i.message)&&this.props.backend.roles.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({...I}):(d=this.props.history)==null||d.push({pathname:"/admin/roles",state:{message:this.props.backend.roles.message}})),!((m=(l=s.backend)==null?void 0:l.roles)!=null&&m.role)&&((p=(c=this.props.backend)==null?void 0:c.roles)!=null&&p.role)){const{backend:{roles:{role:f}}}=this.props;this.setState({...f})}}componentWillUnmount(){var s,t;(t=(s=this.props).reset)==null||t.call(s)}render(){var y,N;if(!((y=this.props.content)!=null&&y.cms)||!((N=this.props.backend)!=null&&N.roles))return null;let{content:{cms:{pages:{backend:{pages:{roles:{title:s,add:t,edit:r,index:o,form:i}}}}}},backend:{roles:{loading:d,error:l,message:m,features:c}}}=this.props,{name:p,description:f,features:x}=this.state,j,b=null;c||(c=[]);const T=c.sort((h,g)=>h.name.localeCompare(g.name)).map(h=>{const g=x.find(u=>u.id&&+u.id==+h.id),A=[{abbr:"c",name:i.create},{abbr:"u",name:i.update},{abbr:"d",name:i.delete}].map(u=>{var F;const D=g&&((F=g.permissions)==null?void 0:F.includes(u.abbr));return e.jsx(S,{lg:4,children:e.jsx($,{children:e.jsx(R,{type:"checkbox",id:`feature-${h.id}-${u.abbr}`,checked:D,name:`features[${h.id}][permissions][${u.abbr}]`,onChange:this.inputChangeHandler,label:u.name})})},JSON.stringify(u))}),H=g!==void 0;return e.jsxs("div",{children:[e.jsx(R,{type:"switch",id:`feature-${h.id}`,className:"col-12 pb-2",checked:H,name:`features[${h.id}][id]`,onChange:this.inputChangeHandler,label:e.jsx("span",{className:"text-500",children:h.name})}),H&&e.jsx(C,{children:A})]},JSON.stringify(h))});return d?j=e.jsx(S,{xs:12,children:e.jsx(J,{})}):(b=e.jsx(e.Fragment,{children:e.jsx(G,{err:l})}),j=e.jsx(e.Fragment,{children:e.jsxs(S,{xl:9,children:[e.jsx(K,{message:m}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(C,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsxs(C,{children:[e.jsx(w,{type:"text",className:"col-md-6",icon:v,onChange:this.inputChangeHandler,value:p,name:"name",required:!0,placeholder:i.name}),e.jsx(w,{type:"text",className:"col-md-6",icon:U,onChange:this.inputChangeHandler,value:f,name:"description",required:!0,placeholder:i.description}),e.jsx(S,{xs:12,className:"pb-2 text-large text-700",children:i.features}),e.jsx($,{className:"col-12",children:T})]})}),e.jsx(V,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx(O,{items:this.props.edit?[{to:"/admin/roles",content:o}]:void 0,main:this.props.edit?r:t,icon:v}),e.jsx(P,{children:s}),e.jsx(W,{children:this.props.edit?r:t})]}),e.jsxs("div",{children:[b,e.jsx(C,{children:e.jsx(M,{onSubmit:this.saveHandler,icon:v,title:this.props.edit?r:t,list:o,link:"/admin/roles",innerClassName:"row justify-content-center",children:j})})]})]})}}const se=a=>({...a}),te=a=>({show:n=>a(L(n)),info:()=>a(Q()),post:n=>a(X(n)),patch:(n,s)=>a(Y(n,s)),reset:()=>a(Z())}),xe=B(se,te)(ee);export{xe as default};
