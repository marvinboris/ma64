var H=Object.defineProperty;var w=(a,n,e)=>n in a?H(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var j=(a,n,e)=>w(a,typeof n!="symbol"?n+"":n,e);import{c as P,r as S,u as M,j as s,N as _,C as y,R as f,I as O,a as B}from"./index-BncDn27B.js";import{F as $}from"./FormGroup-CjRq5iBt.js";import{B as E,S as I,a as R}from"./Subtitle-EIBA-Hk5.js";import{e as V}from"./Error-CC8F97pB.js";import{a as z}from"./Input-BldVOD2V.js";import{b as A}from"./BetweenButton-CNQ28UJ2.js";import{T as J}from"./index-C0jNRMwo.js";import{F as L}from"./Feedback-C0SvNv4r.js";import{g as W,p as G,r as U}from"./cms-Dgxu_C9N.js";import{C as T}from"./Components-DHOrEZRE.js";import{r as q}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const F="wrench",K=({components:a,language:n})=>{const[e,r]=S.useState(n.abbr+"-form"),[t,i]=S.useState(a),m=o=>{const{value:c}=o.target;c!==e&&r(c)},C=Object.keys(a||{}).sort((o,c)=>o.localeCompare(c)).map(o=>{const c=`${n.abbr}-${o}`;return s.jsx("option",{className:"text-capitalize",value:c,children:o.split("_").join(" ")},c)}),p=`${n.abbr}[components]`,v=Object.keys(T).map(o=>{const c=T[o],h=`${p}[${o}]`,u=t==null?void 0:t[o],N=[o],x=q(t,i)(c,h,u,N),b=n.abbr+"-"+o;return s.jsx(f,{className:`pt-4 ${e===b?"":"d-none"}`,children:x},n.abbr+"-"+h)});return s.jsxs(f,{children:[s.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:s.jsx($,{children:s.jsx(O,{type:"select",name:"tab",onChange:m,className:"text-capitalize",value:e,children:C})})}),s.jsx("div",{className:"col-12",children:v})]},"Languages-"+n.abbr)};class Q extends S.Component{constructor(){super(...arguments);j(this,"state",{abbr:"fr"});j(this,"submitHandler",async e=>{var r,t;e.preventDefault(),await((t=(r=this.props).patch)==null?void 0:t.call(r,e.target))});j(this,"inputChangeHandler",e=>{const{name:r,value:t,files:i}=e.target;this.setState({[r]:i?i[0]:t})})}static getDerivedStateFromProps(e,r){var t,i;if((i=(t=e.backend)==null?void 0:t.cms)!=null&&i.cms&&r.app_name===""){const{backend:{cms:{cms:{components:m}}}}=e;return M(r,{...m})}return r}async componentDidMount(){var e,r,t,i;(r=(e=this.props).reset)==null||r.call(e),(i=(t=this.props).get)==null||i.call(t)}componentWillUnmount(){var e,r;(r=(e=this.props).reset)==null||r.call(e)}render(){var x,b,k;if(!((x=this.props.content)!=null&&x.cms)||!((b=this.props.backend)!=null&&b.cms)||!((k=this.props.auth)!=null&&k.data))return null;let{content:{cms:{pages:{components:{form:{save:e}},backend:{pages:{cms:{title:r,components:t}}}}}},backend:{cms:{loading:i,error:m,message:C,cms:p,languages:d}},auth:{data:{role:{features:v}}}}=this.props;const{abbr:o}=this.state;let c=null,h=null;const u=v.find(g=>g.prefix==="cms"),N=!(u&&JSON.parse(u.permissions).includes("u"))&&s.jsx(_,{to:"/user/dashboard"});if(i)c=s.jsx(y,{xs:12,children:s.jsx(B,{})});else{h=s.jsx(s.Fragment,{children:s.jsx(V,{err:m})}),d||(d=[]);const g=d.map(l=>s.jsx("option",{value:l.abbr,children:l.name},Math.random()+JSON.stringify(l))),D=d.map(l=>s.jsx("div",{className:l.abbr===o?"":"d-none",children:s.jsx(K,{language:l,components:p==null?void 0:p.pages[l.abbr].components})},Math.random()));c=s.jsxs(y,{lg:9,children:[s.jsx(L,{message:C}),s.jsxs(f,{children:[s.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),s.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:s.jsx($,{children:s.jsx(O,{type:"select",name:"abbr",onChange:this.inputChangeHandler,value:o,children:g})})}),s.jsx("div",{className:"col-12",children:D}),s.jsx("div",{className:"col-12",children:s.jsx(A,{color:"green",icon:"save",children:e})})]})]})}return s.jsxs(s.Fragment,{children:[s.jsxs(J,{children:[s.jsx(E,{main:t,icon:F}),s.jsx(I,{children:r}),s.jsx(R,{children:t})]}),s.jsxs("div",{className:"p-4 pb-0",children:[N,h,s.jsx(f,{children:s.jsx(z,{onSubmit:this.submitHandler,icon:F,title:t,link:"/admin/cms",innerClassName:"row justify-content-center",children:c})})]})]})}}const X=a=>({...a}),Y=a=>({get:()=>a(W()),patch:n=>a(G("components",n)),reset:()=>a(U())}),us=P(X,Y)(Q);export{us as default};
