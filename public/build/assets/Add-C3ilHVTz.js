var D=Object.defineProperty;var E=(o,i,s)=>i in o?D(o,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[i]=s;var m=(o,i,s)=>E(o,typeof i!="symbol"?i+"":i,s);import{c as O,r as $,j as e,N as J,C as _,R as N,F as k,f as A,q as P,a as G}from"./index-BncDn27B.js";import{F as L}from"./FormGroup-CjRq5iBt.js";import{B as M,S as V,a as K}from"./Subtitle-EIBA-Hk5.js";import{e as Q}from"./Error-CC8F97pB.js";import{F as u,a as X}from"./Input-BldVOD2V.js";import{S as Y}from"./index-3VnVM_zO.js";import{T as Z}from"./index-C0jNRMwo.js";import{F as ee}from"./Feedback-C0SvNv4r.js";import{a as se,b as te,p as ae,c as re,r as oe}from"./users-DD1ZIDYJ.js";import{a as ie}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const C="user",I={name:"",phone:"",photo:null,email:"",password:"",password_confirmation:"",role_id:"",add:!1};class ne extends $.Component{constructor(){super(...arguments);m(this,"state",{...I});m(this,"saveHandler",s=>{var t,n,r,a,p;s.preventDefault(),this.props.edit?(r=(n=this.props).patch)==null||r.call(n,(t=this.props.match)==null?void 0:t.params.id,s.target):(p=(a=this.props).post)==null||p.call(a,s.target)});m(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,t;return(t=(s=this.props).post)==null?void 0:t.call(s,document.querySelector("form"))}));m(this,"inputChangeHandler",s=>{const{name:t,value:n,files:r}=s.target;r&&ie(s.target),this.setState({[t]:r?r[0]:n})});m(this,"fileUpload",()=>{var s;return(s=document.getElementById("photo"))==null?void 0:s.click()})}componentDidMount(){var s,t,n,r,a,p;(t=(s=this.props).reset)==null||t.call(s),this.props.edit&&this.props.match?(r=(n=this.props).show)==null||r.call(n,this.props.match.params.id):(p=(a=this.props).info)==null||p.call(a)}componentDidUpdate(s){var t,n,r,a,p,f,g,c,h,j,v,b,l;if(!((n=(t=s.backend)==null?void 0:t.users)!=null&&n.message)&&((a=(r=this.props.backend)==null?void 0:r.users)!=null&&a.message)&&this.props.backend.users.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({...I}):(p=this.props.history)==null||p.push({pathname:"/user/users",state:{message:this.props.backend.users.message}})),!((g=(f=s.backend)==null?void 0:f.users)!=null&&g.user)&&((h=(c=this.props.backend)==null?void 0:c.users)!=null&&h.user)){const{backend:{users:{user:x}}}=this.props;this.setState({...x})}if(this.props.edit&&!((v=(j=s.backend)==null?void 0:j.users)!=null&&v.message)&&((l=(b=this.props.backend)==null?void 0:b.users)!=null&&l.message)&&this.props.backend.users.message.type==="success"){if(!this.props.backend.users.user)return;const{photo:x}=this.props.backend.users.user;this.setState({photo:x})}}componentWillUnmount(){var s,t;(t=(s=this.props).reset)==null||t.call(s)}render(){var H,F,U;if(!((H=this.props.content)!=null&&H.cms)||!((F=this.props.backend)!=null&&F.users)||!((U=this.props.auth)!=null&&U.data))return null;let{content:{cms:{pages:{backend:{pages:{users:{title:s,add:t,edit:n,index:r,form:a}}}}}},backend:{users:{loading:p,error:f,message:g,roles:c,user:h}},auth:{data:{role:{features:j}}}}=this.props,{name:v,phone:b,photo:l,email:x,password:T,password_confirmation:q,role_id:z}=this.state,y,w=null;const S=j.find(d=>d.prefix==="users"),R=!(S&&JSON.parse(S.permissions).includes(this.props.edit?"u":"c"))&&e.jsx(J,{to:"/user/dashboard"});c||(c=[]);const W=c.sort((d,B)=>d.name.localeCompare(B.name)).map(d=>e.jsx("option",{value:d.id,children:d.name},JSON.stringify(d)));return p?y=e.jsx(_,{xs:12,children:e.jsx(G,{})}):(w=e.jsx(e.Fragment,{children:e.jsx(Q,{err:f})}),y=e.jsx(e.Fragment,{children:e.jsxs(_,{xl:9,children:[e.jsx(ee,{message:g}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(N,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsxs(N,{children:[e.jsx(u,{type:"text",className:"col-md-6",icon:C,onChange:this.inputChangeHandler,value:v,name:"name",required:!0,placeholder:a.name}),e.jsx(u,{type:"tel",className:"col-md-6",addon:e.jsx("span",{className:"text-secondary text-small",children:"+237"}),onChange:this.inputChangeHandler,value:b,name:"phone",required:!0,placeholder:a.phone}),e.jsx(u,{type:"password",className:"col-md-6",icon:"lock",onChange:this.inputChangeHandler,value:T,name:"password",placeholder:a.password}),e.jsx(u,{type:"password",className:"col-md-6",icon:"lock",onChange:this.inputChangeHandler,value:q,name:"password_confirmation",placeholder:a.password_confirmation}),e.jsx(u,{type:"email",className:"col-md-6",icon:"envelope",onChange:this.inputChangeHandler,value:x,name:"email",placeholder:a.email}),e.jsxs(u,{className:"col-lg-6",type:"select",name:"role_id",placeholder:a.role,onChange:this.inputChangeHandler,icon:"user-tag",required:!0,value:z,children:[e.jsx("option",{value:"",children:a.select_role}),W]})]})}),e.jsx("div",{className:"col-lg-3",children:e.jsx(L,{children:e.jsx("div",{id:"embed-photo",className:"embed-responsive embed-responsive-1by1 bg-soft rounded-8 d-flex justify-content-center align-items-center position-relative",style:{cursor:"pointer",backgroundImage:l?`url("${l}")`:void 0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",overflow:"visible"},onClick:this.fileUpload,children:this.props.edit?l&&l!==(h==null?void 0:h.photo)&&e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(k,{icon:A,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):l?e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(k,{icon:A,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):e.jsxs("div",{className:"text-center text-light w-100 overflow-hidden px-3",children:[e.jsx("div",{children:e.jsx(k,{icon:P,fixedWidth:!0,size:"4x"})}),e.jsx("div",{className:"mt-3 mb-1 text-center text-12 text-truncate",children:a.upload}),e.jsx("div",{className:"text-center text-12 text-truncate",children:a.size})]})})})}),e.jsx(Y,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{children:[e.jsx(M,{items:this.props.edit?[{to:"/user/users",content:r}]:void 0,main:this.props.edit?n:t,icon:C}),e.jsx(V,{children:s}),e.jsx(K,{children:this.props.edit?n:t})]}),e.jsxs("div",{children:[R,w,e.jsx(N,{children:e.jsxs(X,{onSubmit:this.saveHandler,icon:C,title:this.props.edit?n:t,list:r,link:"/user/users",innerClassName:"row justify-content-center",children:[e.jsx("input",{type:"file",id:"photo",name:"photo",className:"d-none",onChange:this.inputChangeHandler,accept:".png,.jpg,.jpeg"}),y]})})]})]})}}const pe=o=>({...o}),le=o=>({show:i=>o(se(i)),info:()=>o(te()),post:i=>o(ae(i)),patch:(i,s)=>o(re(i,s)),reset:()=>o(oe())}),Ce=O(pe,le)(ne);export{Ce as default};
