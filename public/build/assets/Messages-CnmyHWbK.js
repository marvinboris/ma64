var w=Object.defineProperty;var _=(n,a,e)=>a in n?w(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e;var v=(n,a,e)=>_(n,typeof a!="symbol"?a+"":a,e);import{c as A,r as F,u as E,j as s,N as I,C as f,R as j,I as M,a as P}from"./index-BncDn27B.js";import{F as H}from"./FormGroup-CjRq5iBt.js";import{B as V,S as B,a as R}from"./Subtitle-EIBA-Hk5.js";import{e as z}from"./Error-CC8F97pB.js";import{a as G}from"./Input-BldVOD2V.js";import{b as J}from"./BetweenButton-CNQ28UJ2.js";import{T as L}from"./index-C0jNRMwo.js";import{F as U}from"./Feedback-C0SvNv4r.js";import{g as W,p as q,r as K}from"./cms-Dgxu_C9N.js";import{M as y}from"./Messages-DJYfvaFB.js";import{r as T}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const D="wrench",Q=({sm:n=!1})=>s.jsx(f,{xs:12,className:`mb-${n?2:3}`}),X=({messages:n,language:a})=>{const[e,r]=F.useState(`${a.abbr}-auth`),[t,o]=F.useState(n),d=c=>{const{value:i}=c.target;i!==e&&r(i)},C=Object.keys(n||{}).sort((c,i)=>c.localeCompare(i)).map(c=>{const i=`${a.abbr}-${c}`;return s.jsx("option",{className:"text-capitalize",value:i,children:c.split("_").join(" ")},i)}),m=`${a.abbr}[messages]`,p=y.auth,h=`${m}[auth]`,g=t==null?void 0:t.auth,u=["auth"],N=T(t,o)(p,h,g,u,[{regex:`${h}[admin][not_found]`,action:()=>s.jsx(f,{xs:12,children:s.jsx("h4",{children:"Admin"})})},{regex:`${h}[user][inactive]`,action:()=>s.jsxs(s.Fragment,{children:[s.jsx(Q,{}),s.jsx(f,{xs:12,children:s.jsx("h4",{children:"User"})})]})}]),$=Object.keys(y).filter(c=>!["auth"].includes(c)).map(c=>{const i=y[c],x=`${m}[${c}]`,b=t==null?void 0:t[c],k=[c],l=T(t,o)(i,x,b,k),O=a.abbr+"-"+c;return s.jsx(j,{className:`pt-4 ${e===O?"":"d-none"}`,children:l},a.abbr+"-"+x)});return s.jsxs(j,{children:[s.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:s.jsx(H,{children:s.jsx(M,{type:"select",name:"tab",onChange:d,className:"text-capitalize",value:e,children:C})})}),s.jsxs("div",{className:"col-12",children:[s.jsx(j,{className:`pt-4 ${e===a.abbr+"-auth"?"":"d-none"}`,children:N}),$]})]},"Languages-"+a.abbr)};class Y extends F.Component{constructor(){super(...arguments);v(this,"state",{abbr:"fr"});v(this,"submitHandler",async e=>{var r,t;e.preventDefault(),await((t=(r=this.props).patch)==null?void 0:t.call(r,e.target))});v(this,"inputChangeHandler",e=>{const{name:r,value:t,files:o}=e.target;this.setState({[r]:o?o[0]:t})})}static getDerivedStateFromProps(e,r){var t,o;if((o=(t=e.backend)==null?void 0:t.cms)!=null&&o.cms&&r.app_name===""){const{backend:{cms:{cms:{messages:d}}}}=e;return E(r,{...d})}return r}async componentDidMount(){var e,r,t,o;(r=(e=this.props).reset)==null||r.call(e),(o=(t=this.props).get)==null||o.call(t)}componentWillUnmount(){var e,r;(r=(e=this.props).reset)==null||r.call(e)}render(){var c,i,x;if(!((c=this.props.content)!=null&&c.cms)||!((i=this.props.backend)!=null&&i.cms)||!((x=this.props.auth)!=null&&x.data))return null;let{content:{cms:{pages:{components:{form:{save:e}},backend:{pages:{cms:{title:r,messages:t}}}}}},backend:{cms:{loading:o,error:d,message:C,cms:m,languages:p}},auth:{data:{role:{features:h}}}}=this.props;const{abbr:g}=this.state;let u=null,N=null;const S=h.find(b=>b.prefix==="cms"),$=!(S&&JSON.parse(S.permissions).includes("u"))&&s.jsx(I,{to:"/user/dashboard"});if(o)u=s.jsx(f,{xs:12,children:s.jsx(P,{})});else{N=s.jsx(s.Fragment,{children:s.jsx(z,{err:d})}),p||(p=[]);const b=p.map(l=>s.jsx("option",{value:l.abbr,children:l.name},Math.random()+JSON.stringify(l))),k=p.map(l=>s.jsx("div",{className:l.abbr===g?"":"d-none",children:s.jsx(X,{language:l,messages:m==null?void 0:m.pages[l.abbr].messages})},Math.random()));u=s.jsxs(f,{lg:9,children:[s.jsx(U,{message:C}),s.jsxs(j,{children:[s.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),s.jsx("div",{className:"col-md-6 col-xl-4 col-xxl-3",children:s.jsx(H,{children:s.jsx(M,{type:"select",name:"abbr",onChange:this.inputChangeHandler,value:g,children:b})})}),s.jsx("div",{className:"col-12",children:k}),s.jsx("div",{className:"col-12",children:s.jsx(J,{color:"green",icon:"save",children:e})})]})]})}return s.jsxs(s.Fragment,{children:[s.jsxs(L,{children:[s.jsx(V,{main:t,icon:D}),s.jsx(B,{children:r}),s.jsx(R,{children:t})]}),s.jsxs("div",{className:"p-4 pb-0",children:[$,N,s.jsx(j,{children:s.jsx(G,{onSubmit:this.submitHandler,icon:D,title:t,link:"/admin/cms",innerClassName:"row justify-content-center",children:u})})]})]})}}const Z=n=>({...n}),ss=n=>({get:()=>n(W()),patch:a=>n(q("messages",a)),reset:()=>n(K())}),bs=A(Z,ss)(Y);export{bs as default};
