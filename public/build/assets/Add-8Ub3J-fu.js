var G=Object.defineProperty;var L=(i,o,s)=>o in i?G(i,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[o]=s;var u=(i,o,s)=>L(i,typeof o!="symbol"?o+"":o,s);import{c as M,r as q,j as e,N as V,C as z,R as S,I as K,F,f as O,q as Q,a as X}from"./index-BncDn27B.js";import{F as w}from"./FormGroup-CjRq5iBt.js";import{B as Y,S as Z,a as ee}from"./Subtitle-EIBA-Hk5.js";import{e as se}from"./Error-CC8F97pB.js";import{F as v,a as te}from"./Input-BldVOD2V.js";import{S as ae}from"./index-3VnVM_zO.js";import{T as re}from"./index-C0jNRMwo.js";import{F as ie}from"./Feedback-C0SvNv4r.js";import{a as oe,b as ne,p as de,c as ce,r as pe}from"./products-PvmdFcpO.js";import{a as le}from"./types-DL2rpS-Q.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const H="store",R={name:{},description:{},photo:null,price:"",brand_id:"",is_active:"1",translate:"",add:!1};class me extends q.Component{constructor(){super(...arguments);u(this,"state",{...R});u(this,"saveHandler",s=>{var a,p,r,n,d;s.preventDefault(),this.props.edit?(r=(p=this.props).patch)==null||r.call(p,(a=this.props.match)==null?void 0:a.params.id,s.target):(d=(n=this.props).post)==null||d.call(n,s.target)});u(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,a;return(a=(s=this.props).post)==null?void 0:a.call(s,document.querySelector("form"))}));u(this,"inputChangeHandler",s=>{const{name:a,value:p,files:r}=s.target;if(r&&le(s.target),a.includes("[")){const{translate:n}=this.state,d=a.split("[")[0],c=this.state[d];return c&&(c[n]=p),this.setState({[d]:c})}this.setState({[a]:r?r[0]:p})});u(this,"fileUpload",()=>{var s;return(s=document.getElementById("photo"))==null?void 0:s.click()})}componentDidMount(){var s,a,p,r,n,d;(a=(s=this.props).reset)==null||a.call(s),this.props.edit&&this.props.match?(r=(p=this.props).show)==null||r.call(p,this.props.match.params.id):(d=(n=this.props).info)==null||d.call(n),this.setState({translate:"fr"})}componentDidUpdate(s){var a,p,r,n,d,c,l,j,b,f,m,h,g;if(!((p=(a=s.backend)==null?void 0:a.products)!=null&&p.message)&&((n=(r=this.props.backend)==null?void 0:r.products)!=null&&n.message)&&this.props.backend.products.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({...R,translate:"fr"}):(d=this.props.history)==null||d.push({pathname:"/user/products",state:{message:this.props.backend.products.message}})),!((l=(c=s.backend)==null?void 0:c.products)!=null&&l.product)&&((b=(j=this.props.backend)==null?void 0:j.products)!=null&&b.product)||this.props.edit&&!((m=(f=s.backend)==null?void 0:f.products)!=null&&m.message)&&((g=(h=this.props.backend)==null?void 0:h.products)!=null&&g.message)&&this.props.backend.products.message.type==="success"){const{backend:{products:{product:N}}}=this.props;this.setState({...N})}}componentWillUnmount(){var s,a;(a=(s=this.props).reset)==null||a.call(s)}render(){var A,P,T;if(!((A=this.props.content)!=null&&A.cms)||!((P=this.props.backend)!=null&&P.products)||!((T=this.props.auth)!=null&&T.data))return null;let{content:{cms:{pages:{components:{form:{active:s,inactive:a}},backend:{pages:{products:{title:p,add:r,edit:n,index:d,form:c}}}}},languages:l},backend:{products:{loading:j,error:b,message:f,product:m,brands:h}},auth:{data:{role:{features:g}}}}=this.props,{name:N,photo:x,brand_id:U,is_active:W,price:B,description:D,translate:y}=this.state,C,_=null;localStorage.getItem("lang");const I=g.find(t=>t.prefix==="products"),E=!(I&&JSON.parse(I.permissions).includes(this.props.edit?"u":"c"))&&e.jsx(V,{to:"/user/dashboard"}),J=l==null?void 0:l.sort((t,k)=>t.name.localeCompare(k.name)).map(t=>e.jsx("option",{value:t.abbr,children:t.name},JSON.stringify(t)));h||(h=[]);const $=h.sort((t,k)=>t.name.localeCompare(k.name)).map(t=>e.jsx("option",{value:t.id,children:t.name},JSON.stringify(t)));return j?C=e.jsx(z,{xs:12,children:e.jsx(X,{})}):(_=e.jsx(e.Fragment,{children:e.jsx(se,{err:b})}),C=e.jsx(e.Fragment,{children:e.jsxs(z,{xl:9,children:[e.jsx(ie,{message:f}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(S,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsx("div",{className:"row",children:l==null?void 0:l.map(t=>e.jsxs(q.Fragment,{children:[e.jsx(v,{type:"text",id:"name-"+t.abbr,className:"col-md-12"+(t.abbr===y?"":" d-none"),icon:H,onChange:this.inputChangeHandler,value:N[t.abbr],name:"name["+t.abbr+"]",required:!0,placeholder:c.name}),e.jsxs(w,{id:"description-"+t.abbr,className:"col-md-12"+(t.abbr===y?"":" d-none"),children:[this.props.edit&&m&&m.description[t.abbr]===D[t.abbr]&&e.jsx(e.Fragment,{}),!this.props.edit&&e.jsx(e.Fragment,{})]})]},"language-"+t.abbr))})}),e.jsx("div",{className:"col-lg-3",children:e.jsx(w,{children:e.jsx(K,{type:"select",name:"translate",onChange:this.inputChangeHandler,value:y,children:J})})}),e.jsx("div",{className:"col-12 mb-3",children:e.jsx("hr",{})}),e.jsx("div",{className:"col-lg-9",children:e.jsx(w,{children:e.jsx("div",{id:"embed-photo",className:"embed-responsive embed-responsive-21by9 bg-soft rounded-8 d-flex justify-content-center align-items-center position-relative",style:{cursor:"pointer",backgroundImage:x?`url("${x}")`:void 0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",overflow:"visible"},onClick:this.fileUpload,children:this.props.edit?x&&x!==(m==null?void 0:m.photo)&&e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(F,{icon:O,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):x?e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(F,{icon:O,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):e.jsxs("div",{className:"text-center text-light w-100 overflow-hidden px-3",children:[e.jsx("div",{children:e.jsx(F,{icon:Q,fixedWidth:!0,size:"4x"})}),e.jsx("div",{className:"mt-3 mb-1 text-center text-12 text-truncate",children:c.upload}),e.jsx("div",{className:"text-center text-12 text-truncate",children:c.size})]})})})}),e.jsx("div",{className:"col-lg-9",children:e.jsxs(S,{children:[e.jsx(v,{type:"number",className:"col-md-6",icon:"dollar-sign",onChange:this.inputChangeHandler,name:"price",value:B,placeholder:c.price}),e.jsxs(v,{className:"col-md-6",type:"select",name:"brand_id",placeholder:c.brand,onChange:this.inputChangeHandler,icon:"th-list",required:!0,value:U,children:[e.jsx("option",{children:c.select_brand}),$]}),e.jsxs(v,{type:"select",className:"col-md-6",icon:"pencil-alt",onChange:this.inputChangeHandler,value:W,name:"is_active",required:!0,children:[e.jsx("option",{children:c.select_status}),e.jsx("option",{value:1,children:s}),e.jsx("option",{value:0,children:a})]})]})}),e.jsx(ae,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(Y,{items:this.props.edit?[{to:"/user/products",content:d}]:void 0,main:this.props.edit?n:r,icon:H}),e.jsx(Z,{children:p}),e.jsx(ee,{children:this.props.edit?n:r})]}),e.jsxs("div",{children:[E,_,e.jsx(S,{children:e.jsxs(te,{onSubmit:this.saveHandler,icon:H,title:this.props.edit?n:r,list:d,link:"/user/products",innerClassName:"row justify-content-center",children:[e.jsx("input",{type:"file",id:"photo",name:"photo",className:"d-none",onChange:this.inputChangeHandler,accept:".png,.jpg,.jpeg"}),C]})})]})]})}}const he=i=>({...i}),ue=i=>({show:o=>i(oe(o)),info:()=>i(ne()),post:o=>i(de(o)),patch:(o,s)=>i(ce(o,s)),reset:()=>i(pe())}),_e=M(he,ue)(me);export{_e as default};
