var z=Object.defineProperty;var B=(o,n,s)=>n in o?z(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var c=(o,n,s)=>B(o,typeof n!="symbol"?n+"":n,s);import{c as D,r as E,j as e,C as U,R as k,aU as w,aZ as F,a_ as L,b9 as W,F as C,f as _,q as $,a as M}from"./index-BncDn27B.js";import{F as O}from"./FormGroup-CjRq5iBt.js";import{B as P,S as G,a as J}from"./Subtitle-EIBA-Hk5.js";import{e as V}from"./Error-CC8F97pB.js";import{F as u,a as Z}from"./Input-BldVOD2V.js";import{S as K}from"./index-3VnVM_zO.js";import{T as Q}from"./index-C0jNRMwo.js";import{F as X}from"./Feedback-C0SvNv4r.js";import{a as Y,b as ee,p as se,c as te,r as ae}from"./users-DD1ZIDYJ.js";import"./app-BShz7gyO.js";import"./BreadcrumbItem-BLbML1-v.js";import"./WithTooltip-yJJWpatI.js";const A={name:"",phone:"",photo:null,email:"",password:"",password_confirmation:"",role_id:"",add:!1};class re extends E.Component{constructor(){super(...arguments);c(this,"state",{...A});c(this,"saveHandler",s=>{var t,r,i,a,l;s.preventDefault(),this.props.edit?(i=(r=this.props).patch)==null||i.call(r,(t=this.props.match)==null?void 0:t.params.id,s.target):(l=(a=this.props).post)==null||l.call(a,s.target)});c(this,"saveAddHandler",()=>this.setState({add:!0},()=>{var s,t;return(t=(s=this.props).post)==null?void 0:t.call(s,document.querySelector("form"))}));c(this,"inputChangeHandler",s=>{const{name:t,value:r,files:i}=s.target;i&&this.readURL(s.target),this.setState({[t]:i?i[0]:r})});c(this,"readURL",s=>{if(s.files&&s.files[0]){const t=s.files[0],r=new FileReader;r.onload=function(i){var p;const a=document.getElementById(`embed-${s.name}`);if(!a)return;a.style.backgroundImage=`url('${(p=i.target)==null?void 0:p.result}')`,a.style.backgroundSize="cover";const l=a.querySelector(".file-selected");l&&(l.innerHTML=t.name)},r.readAsDataURL(t)}});c(this,"fileUpload",()=>{var s;return(s=document.getElementById("photo"))==null?void 0:s.click()})}componentDidMount(){var s,t,r,i,a;(t=(s=this.props).reset)==null||t.call(s),this.props.edit&&this.props.match&&((a=(i=this.props).show)==null||a.call(i,(r=this.props.match)==null?void 0:r.params.id))}componentDidUpdate(s){var t,r,i,a,l,p,g,m,h,j,b,d,v;if(!((r=(t=s.backend)==null?void 0:t.users)!=null&&r.message)&&((a=(i=this.props.backend)==null?void 0:i.users)!=null&&a.message)&&this.props.backend.users.message.type==="success"&&!this.props.edit&&(this.state.add?this.setState({...A}):(l=this.props.history)==null||l.push({pathname:"/admin/users",state:{message:this.props.backend.users.message}})),!((g=(p=s.backend)==null?void 0:p.users)!=null&&g.user)&&((h=(m=this.props.backend)==null?void 0:m.users)!=null&&h.user)){const{backend:{users:{user:x}}}=this.props;this.setState({...x})}if(this.props.edit&&!((b=(j=s.backend)==null?void 0:j.users)!=null&&b.message)&&((v=(d=this.props.backend)==null?void 0:d.users)!=null&&v.message)&&this.props.backend.users.message.type==="success"){if(!this.props.backend.users.user)return;const{photo:x}=this.props.backend.users.user;this.setState({photo:x})}}componentWillUnmount(){var s,t;(t=(s=this.props).reset)==null||t.call(s)}render(){var S,H;if(!((S=this.props.content)!=null&&S.cms)||!((H=this.props.backend)!=null&&H.users))return null;let{content:{cms:{pages:{backend:{pages:{users:{title:s,add:t,edit:r,index:i,form:a}}}}}},backend:{users:{loading:l,error:p,message:g,roles:m,user:h}}}=this.props,{name:j,phone:b,photo:d,email:v,password:x,password_confirmation:I,role_id:R}=this.state,y,N=null;m||(m=[]);const T=m.sort((f,q)=>f.name.localeCompare(q.name)).map(f=>e.jsx("option",{value:f.id,children:f.name},JSON.stringify(f)));return l?y=e.jsx(U,{xs:12,children:e.jsx(M,{})}):(N=e.jsx(e.Fragment,{children:e.jsx(V,{err:p})}),y=e.jsx(e.Fragment,{children:e.jsxs(U,{xl:9,children:[e.jsx(X,{message:g}),this.props.edit&&e.jsx("input",{type:"hidden",name:"_method",defaultValue:"PATCH"}),e.jsx("div",{className:"shadow-lg rounded-8 bg-white px-4 px-sm-5 py-3 py-sm-4",children:e.jsxs(k,{className:"my-2 my-sm-3",children:[e.jsx("div",{className:"col-lg-9",children:e.jsxs(k,{children:[e.jsx(u,{type:"text",className:"col-md-6",icon:w,onChange:this.inputChangeHandler,value:j,name:"name",required:!0,placeholder:a.name}),e.jsx(u,{type:"tel",className:"col-md-6",addon:e.jsx("span",{className:"text-secondary text-small",children:"+237"}),onChange:this.inputChangeHandler,value:b,name:"phone",required:!0,placeholder:a.phone}),e.jsx(u,{type:"password",className:"col-md-6",icon:F,onChange:this.inputChangeHandler,value:x,name:"password",placeholder:a.password}),e.jsx(u,{type:"password",className:"col-md-6",icon:F,onChange:this.inputChangeHandler,value:I,name:"password_confirmation",placeholder:a.password_confirmation}),e.jsx(u,{type:"email",className:"col-md-6",icon:L,onChange:this.inputChangeHandler,value:v,name:"email",placeholder:a.email}),e.jsxs(u,{className:"col-lg-6",type:"select",name:"role_id",placeholder:a.role,onChange:this.inputChangeHandler,icon:W,required:!0,value:R,children:[e.jsx("option",{value:"",children:a.select_role}),T]})]})}),e.jsx("div",{className:"col-lg-3",children:e.jsx(O,{children:e.jsx("div",{id:"embed-photo",className:"embed-responsive embed-responsive-1by1 bg-soft rounded-8 d-flex justify-content-center align-items-center position-relative",style:{cursor:"pointer",backgroundImage:d?`url("${d}")`:void 0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",overflow:"visible"},onClick:this.fileUpload,children:this.props.edit?d&&d!==(h==null?void 0:h.photo)&&e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(C,{icon:_,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):d?e.jsxs("div",{className:"text-center text-green w-100",children:[e.jsx("div",{className:"position-absolute",style:{top:0,right:0,transform:"translate(50%,-50%)"},children:e.jsx(C,{icon:_,fixedWidth:!0,size:"2x"})}),e.jsx("div",{className:"position-absolute file-selected text-truncate w-100 pt-3",style:{top:"100%",left:0}})]}):e.jsxs("div",{className:"text-center text-light w-100 overflow-hidden px-3",children:[e.jsx("div",{children:e.jsx(C,{icon:$,fixedWidth:!0,size:"4x"})}),e.jsx("div",{className:"mt-3 mb-1 text-center text-12 text-truncate",children:a.upload}),e.jsx("div",{className:"text-center text-12 text-truncate",children:a.size})]})})})}),e.jsx(K,{edit:!!this.props.edit,saveAddHandler:this.saveAddHandler})]})})]})})),e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(P,{items:this.props.edit?[{to:"/admin/users",content:i}]:void 0,main:this.props.edit?r:t,icon:w}),e.jsx(G,{children:s}),e.jsx(J,{children:this.props.edit?r:t})]}),e.jsxs("div",{children:[N,e.jsx(k,{children:e.jsxs(Z,{onSubmit:this.saveHandler,icon:w,title:this.props.edit?r:t,list:i,link:"/admin/users",innerClassName:"row justify-content-center",children:[e.jsx("input",{type:"file",id:"photo",name:"photo",className:"d-none",onChange:this.inputChangeHandler,accept:".png,.jpg,.jpeg"}),y]})})]})]})}}const ie=o=>({...o}),oe=o=>({show:n=>o(Y(n)),info:()=>o(ee()),post:n=>o(se(n)),patch:(n,s)=>o(te(n,s)),reset:()=>o(ae())}),ve=D(ie,oe)(re);export{ve as default};
